var MVC=function(){var e=require("/MVC/utils"),t=function(e){return/iphone|ipad/i.test(e)?"iOS":/android/i.test(e)?"Android":"MobileWeb"}(Ti.Platform.osname),n=function(e){return e.replace(/Views\//i,function(e){return e+t+"/"})},r={view:function(){var n=require(e._format("MVC/Views/{0}/{1}/{2}",t,arguments[0],arguments[1]));switch(arguments.length){case 2:return new n;break;case 3:n.prototype.ViewData=arguments[2];return new n;break;case 4:n.prototype.ViewData=arguments[2];return new n(arguments[3]);break}},model:function(t){var n=require(e._format("/MVC/Models/{0}Model",t));return"function"===typeof n?new n:n},controller:function(e){var t=require("/MVC/Controllers/"+e+"Controller");return"function"===typeof t?new t:t}},i=function(t){var i=this;this.Name=t;this.Methods=[];this.setAction=function(t,s){this.Methods.push({Controller:i.Name,Name:t,Method:s,ViewData:{},redirectToAction:function(){if(!arguments.length){throw"MVC: RedirectToAction takes at least one argument."}else if(arguments.length==1){return f(i.Name,arguments[0])}else if(arguments.length>2){Array.prototype.unshift.apply(arguments,[i.Name]);return f.apply(null,arguments)}},View:function(){if(arguments.length==0){if(e._empty(this.ViewData)){return r.view(this.Controller,this.Name)}else{return r.view(this.Controller,this.Name,this.ViewData)}}else if(arguments.length==1){if(e._empty(this.ViewData)){switch(e._type(arguments[0])){case"string":if(Ti.Filesystem.getFile(n(arguments[0])).exists()){var t=require(n(arguments[0].replace(".js","")));return"function"===typeof t?new t:t}break;case"object":return r.view(this.Controller,this.Name,{},arguments[0]);break;case"array":return r.view(this.Controller,this.Name,{},arguments[0]);break}}else{switch(e._type(arguments[0])){case"string":if(Ti.Filesystem.getFile(arguments[0]).exists()){var t=require(n(arguments[0].replace(".js","")));if("function"===typeof t){t.prototype.ViewData=this.ViewData;return new t}else{t.ViewData=this.ViewData;return t}}break;case"object":return r.view(this.Controller,this.Name,this.ViewData,arguments[0]);break;case"array":return r.view(this.Controller,this.Name,this.ViewData,arguments[0]);break}}}else if(arguments.length==2){if(e._type(arguments[0],arguments[1])==("string:object"||"string:array")){if(e._empty(this.ViewData)){if(Ti.Filesystem.getFile(n(arguments[0])).exists()){var t=require(n(arguments[0].replace(".js","")));return"function"===typeof t?new t(arguments[1]):t}}else{if(Ti.Filesystem.getFile(arguments[0]).exists()){var t=require(n(arguments[0].replace(".js","")));if("function"===typeof t){t.prototype.ViewData=this.ViewData;return new t(arguments[1])}else{t.ViewData=this.ViewData;return t}}}}}}});return this};this.create=function(){return function(){var e=i.Name,t=i.Methods,n;(function(){n={};for(var e=0;e<t.length;e++){n[t[e].Name]=function(e){return function(){return function(){return e.Method.apply(e,arguments)}}}(t[e])}})();return{Methods:n}}()}},s=function(t){var n=this;this.Properties={};this.setProperty=function(){if(arguments.length<2){throw"MVC.Model takes at least two arguments."}this.Properties[arguments[0]]={value:arguments[1],isRequired:arguments[2]||false,regex:arguments[3]||false,errorMessage:arguments[4]||false};return this};this.create=function(){return function(){var t=function(){var t=n.Properties;this.getProperties=function(){var e={};for(var n in t){e[n]=t[n].value}return!arguments.length?e:e[arguments[0]]};this.Fill=function(e){for(var n in e){if(t.hasOwnProperty(n)){t[n].value=e[n]}}return this};this.getErrors=function(){var n={};for(var r in t){if(t[r].isRequired&&e._emptyString(t[r].value)){n[r]=t[r].errorMessage}if(t[r].regex&&!t[r].regex.test(t[r].value)){n[r]=t[r].errorMessage}}return n};this.isValid=function(){var n=true;for(var r in t){if(t[r].isRequired&&e._emptyString(t[r].value)){n=false}if(t[r].regex&&!t[r].regex.test(t[r].value)){n=false}}return n};return this};return new t}()};return this},o=function(e){return new i(e)},u=function(e){return new s(e)},a=function(e){return r.model(e)},f=function(){if(arguments.length<1){throw"MVC.Invoke requires a minimum of one argument."}var t;if(arguments.length==1){t=r.controller(arguments[0]).Methods["Index"];if("undefined"===typeof t){throw e._format("MVC.Invoke: {0}Controller does not have an Index method",arguments[0])}return t.call(t).apply(t)}else{t=r.controller(arguments[0]).Methods[arguments[1]]}if(arguments.length==2){return t.call(t).apply(t)}else if(arguments.length>2){Array.prototype.splice.apply(arguments,[0,2]);return t.call(t).apply(t,arguments)}};return{InvokeController:f,InvokeModel:a,Controller:o,Model:u}}();module.exports=MVC